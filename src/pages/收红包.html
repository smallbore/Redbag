<!DOCTYPE html>
<html lang="zh-cmn-Hans">
<head>
    @@include('./include/header.html')
    <title>收红包</title>
    <style>
        .amap-icon img{width: 100%;height:100%;}
        .amap-logo,.amap-copyright{display:none !important;}
  </style>
</head>
<body>
<div class="page">
    <div class="page-hd">
        <div class="header">
            <div class="header-left">
                <a href="javascript:;" class="xie_icon" style="padding-left:8px">
                    <img src="../assets/images/map_icon00.png" alt="" />
                </a>
            </div>
            <div class="header-title">收红包26655266555</div>
            <div class="header-right">
                <a href="javascript:;" class="xie_icon">
                    <img src="../assets/images/map_icon.png" alt="" />
                </a>
            </div>
        </div>
    </div>
    <div class="page-bd">
        <!-- 页面内容-->
        <div id="container" style="height:100%"></div>
        <div class="map_addbtn">
            <a class="flex_add" href="发红包-发广播.html">
                <img src="../assets/images/map_btn.png">
                <p>发红包</p>
            </a>
        </div>
        <div class="weui-flex map_addbox">
            <div class="map_icon">
                <img src="../assets/images/map_add.png" alt="" />
            </div>
            <div class="weuo-flex__item">
                <div class="m_text">1000米</div>
                <div class="m_text">扩张收红包范围</div>
            </div>
        </div>
        <div class="weui-flex map_banner">
            <div class="map_icon">
                <img src="../assets/images/map_add.png" alt="" />
            </div>
            <div class="weuo-flex__item">
                <div class="m_text">下一个广告红包</div>
                <div class="x_title">00:05:09</div>
            </div>
        </div>
    </div>
    <div class="bottom-tabbar">
        <a href="收红包.html" class="bottom-tabbar__item active">
            <span class="icon">
                <img src="../assets/images/bottom_icon01.png" />
                <img class="lhimg" src="../assets/images/bottom_icon01_lh.png" />
            </span>
            <p class="label">收红包</p>
        </a>
        <a href="钱包.html" class="bottom-tabbar__item ">
            <span class="icon">
                <img src="../assets/images/bottom_icon02.png" />
                <img class="lhimg" src="../assets/images/bottom_icon02_lh.png" />
            </span>
            <p class="label">钱包</p>
        </a>
    </div>
</div>
<!-- 红包 -->
<div id="bagdefault" class="weui-popup__container popup-bottom popup-center">
    <div class="weui-popup__overlay"></div>
    <div class="weui-popup__modal pass_modal" style="background:transparent;overflow:initial;">
        <div class="red_bag">
            <div class="red_bag-close close-popup"></div>
            <div class="red_text-box">
                <div class="weui-top_img">
                    <img src="../assets/images/tx00.jpg" alt="" />
                </div>
                <!-- <div class="weui-top_img" style="background:none">
                    <img src="../assets/images/map_bagkey.png" alt="" />
                </div> -->
                <div class="name_tip">收到 ~小情调~ 的祝福红包</div>
                <div class="money_get" style="font-size:initial">
                    <span class="fs32">给你发了一个广告红包</span>
                </div>
                <div class="open_btn">
                    <img src="../assets/images/map_bagopen.png" alt="" />
                </div>
            </div>
            <div class="bottom_icon"></div>
        </div>
    </div>
</div>

<!-- 红包 密码 -->
<div id="bagpass" class="weui-popup__container popup-bottom popup-center">
    <div class="weui-popup__overlay"></div>
    <div class="weui-popup__modal pass_modal" style="background:transparent;overflow:initial;">
        <div class="red_bag red_bag-pass">
            <div class="red_bag-close close-popup"></div>
            <div class="red_text-box">
                <div class="weui-top_img" style="background:none">
                    <img src="../assets/images/map_bagkey.png" alt="" />
                </div>
                <div class="name_tip">~小情调天使~</div>
                <div class="money_get" style="font-size:initial">
                    <span class="fs32">给你发了一个广播红包</span>
                </div>

                <div class="input_hide" style="position:absolute;left:-1000px;">
                    <input class="weui-input" type="tel" id="wordpass" maxlength="4" onkeyup="inpChange()" />
                </div>
                <label class="weui-flex input_flexbox" for="wordpass">
                    <div class="weui-flex__item">
                        <div class="passinput blink"></div>
                    </div>
                    <div class="weui-flex__item">
                        <div class="passinput"> </div>
                    </div>
                    <div class="weui-flex__item">
                        <div class="passinput"> </div>
                    </div>
                    <div class="weui-flex__item">
                        <div class="passinput"> </div>
                    </div>
                </label>
                <div class="name_tip">
                    <span class="fs28">请输入密码</span>
                    <img src="../assets/images/map_bagwen.png" class="map_bagwen" alt="" />
                </div>
            </div>

            <div class="bottom_tip">
                <span class="out_time">剩余时间 01:32</span>
                <div class="name_tip">
                    <span class="fs26">加我微信可以获取密码lin123</span>
                </div>
            </div>
        </div>
    </div>
</div>


@@include('./include/footer.html')

<script src="//webapi.amap.com/maps?v=1.3&key=b65f7ba655e25ed2300f273950fe20bd"></script>
<script type="text/javascript">
    var provinces = [{
        "name": "密码红包",
        "center": "113.393934,23.127951",
        "type": 1,
        "subDistricts": []
    }, {
        "name": "广告红包",
        "center": "113.389234,23.126589",
        "type": 2,
        "subDistricts": []
    }, {
        "name": "红包",
        "center": "113.388279,23.127107",
        "type": 3,
        "subDistricts": []
    }, {
        "name": "密码红包",
        "center": "113.38925,23.125602",
        "type": 1,
        "subDistricts": []
    }, {
        "name": "广告红包",
        "center": "113.280637,23.125178",
        "type": 2,
        "subDistricts": []
    }, {
        "name": "红包",
        "center": "113.54909,22.198951",
        "type": 3,
        "subDistricts": []
    }];
    var map = new AMap.Map('container', { resizeEnable: true, zoom: 8 });
    var markers = [];
    //province见Demo引用的JS文件
    for (var i = 0; i < provinces.length; i += 1) {
        var marker;
        if (provinces[i].type === 1) {
            var icon = new AMap.Icon({
                image: '../assets/images/map_bag01.png',
                size: new AMap.Size(28, 38)
            });
            marker = new AMap.Marker({
                icon: icon,
                position: provinces[i].center.split(','),
                offset: new AMap.Pixel(-12, -12),
                zIndex: 101,
                title: provinces[i].name,
                map: map
            });

            marker.on('click', markerClick);
        }else if (provinces[i].type === 2) {
            var icon = new AMap.Icon({
                image: '../assets/images/map_bag02.png',
                size: new AMap.Size(28, 38)
            });
            marker = new AMap.Marker({
                icon: icon,
                position: provinces[i].center.split(','),
                offset: new AMap.Pixel(-12, -12),
                zIndex: 101,
                title: provinces[i].name,
                map: map
            });
            marker.on('click', markerClick);
        }else if (provinces[i].type === 3) {
            var icon = new AMap.Icon({
                image: '../assets/images/map_bag03.png',
                size: new AMap.Size(28, 38)
            });
            marker = new AMap.Marker({
                icon: icon,
                position: provinces[i].center.split(','),
                offset: new AMap.Pixel(-12, -12),
                zIndex: 101,
                title: provinces[i].name,
                map: map
            });

            marker.on('click', markerClick);
        }

        markers.push(marker);
    }
    map.setFitView();

    var infoWindow = new AMap.InfoWindow({ offset: new AMap.Pixel(0, -20) });

    function markerClick(e) {
        console.log(e);
        console.log(e.target.G.title);
        var _title = e.target.G.title;
        if(_title === "密码红包"){

            $("#bagpass").popup();
            $("#wordpass").focus(); 
        }else{
            $("#bagdefault").popup();
        }
        
        infoWindow.setContent(e.target.content);
        infoWindow.open(map, e.target.getPosition());
    }

    map.plugin('AMap.Geolocation', function () {
        geolocation = new AMap.Geolocation({
            enableHighAccuracy: true,//是否使用高精度定位，默认:true
            timeout: 10000,          //超过10秒后停止定位，默认：无穷大
            maximumAge: 0,           //定位结果缓存0毫秒，默认：0
            convert: true,           //自动偏移坐标，偏移后的坐标为高德坐标，默认：true
            showButton: true,        //显示定位按钮，默认：true
            buttonPosition: 'RB',    //定位按钮停靠位置，默认：'LB'，左下角
            buttonOffset: new AMap.Pixel(10, 40),//定位按钮与设置的停靠位置的偏移量，默认：Pixel(10, 20)
            showMarker: true,        //定位成功后在定位到的位置显示点标记，默认：true
            showCircle: true,        //定位成功后用圆圈表示定位精度范围，默认：true
            panToLocation: true,     //定位成功后将定位到的位置作为地图中心点，默认：true
            zoomToAccuracy: true      //定位成功后调整地图视野范围使定位位置及精度范围视野内可见，默认：false
        });
        map.addControl(geolocation);
        geolocation.getCurrentPosition();
        AMap.event.addListener(geolocation, 'complete', onComplete);//返回定位信息
        AMap.event.addListener(geolocation, 'error', onError);      //返回定位出错信息
    });
    // 获取地位坐标
    function onComplete(data) {
        // map.clearMap();
        var str = ['定位成功'];
        var GetLng = data.position.getLng();
        var GetLat = data.position.getLat()
        navCircle(GetLng, GetLat)
    }
    // 圆
    function navCircle(o,x){
        
        var circle = new AMap.Circle({
            center: new AMap.LngLat(o, x),// 圆心位置
            radius: 200, //半径
            strokeColor: "#F33", //线颜色
            strokeOpacity: 0.35, //线透明度
            strokeWeight: 1, //线粗细度
            fillColor: "#fee4e4", //填充颜色
            fillOpacity: 0.45//填充透明度
        });
        circle.setMap(map);
    }
    
    // 打开红包
    $(".open_btn").on("click",function(){
        var _this =  $(this)
        _this.addClass('amove');
        var timer = setTimeout(function(){
            _this.removeClass('amove');
            window.location.href = '红包信息-抢到.html';
        },2000)
    })
    
    // 密码输入
    function inpChange() {
        var wpval = $('#wordpass').val();

        if (wpval.length === 0) {
            $(".input_flexbox>div").find(".passinput").text('')

            $(".passinput").removeClass("blink")
            $(".input_flexbox>div").eq(0).find(".passinput").addClass("blink")
        } else if (wpval.length === 1) {
            $(".input_flexbox>div").eq(0).find(".passinput").text(wpval[0]).parent().siblings().find(".passinput").text('')

            $(".passinput").removeClass("blink")
            $(".input_flexbox>div").eq(1).find(".passinput").addClass("blink")
        } else if (wpval.length === 2) {
            $(".input_flexbox>div").eq(1).find(".passinput").text(wpval[1])
            $(".input_flexbox>div").eq(2).find(".passinput").text('')
            $(".input_flexbox>div").eq(3).find(".passinput").text('')

            $(".passinput").removeClass("blink")
            $(".input_flexbox>div").eq(2).find(".passinput").addClass("blink")
        } else if (wpval.length === 3) {
            $(".input_flexbox>div").eq(2).find(".passinput").text(wpval[2])
            $(".input_flexbox>div").eq(3).find(".passinput").text('')

            $(".passinput").removeClass("blink")
            $(".input_flexbox>div").eq(3).find(".passinput").addClass("blink")

        } else if (wpval.length === 4) {
            $(".input_flexbox>div").eq(3).find(".passinput").text(wpval[3])
            $("#wordpass").blur()

            $(".passinput").removeClass("blink")
        } else {
            $("#wordpass").blur()
        }
    }
</script>
</body>
</html>